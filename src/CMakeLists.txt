FILE(GLOB_RECURSE OPENVIDEO_SOURCES *.c *.cpp *.cxx)
FILE(GLOB_RECURSE OPENVIDEO_HEADERS RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} ../include/*.h ../include/*.hpp)

IF(OT_USE_AVIFILE64)
   ADD_DEFINITIONS("-DOT_USE_AVIFILE64")
ENDIF(OT_USE_AVIFILE64)

IF(WIN32)
   ADD_DEFINITIONS(-DTINYXML_MOD)
   ADD_DEFINITIONS(-DOT_DO_NOT_LINK_TINYXML) # This is a workaround for win32
   ADD_DEFINITIONS(-DOPENVIDEO_EXPORTS)
   ADD_DEFINITIONS(-DENABLE_GL_TEXTURE_2D_SINK)
   ADD_DEFINITIONS(-DENABLE_VIDEOSINK)
   IF(GLUT_FOUND)
      IF(OT_USE_GLUT)
         ADD_DEFINITIONS(-DENABLE_GLUTSINK)
      ENDIF()
   ENDIF()
   IF(OpenCV_FOUND)
      IF(OT_USE_OPENCV)
         ADD_DEFINITIONS(-DENABLE_OPENCV)
      ENDIF()
   ENDIF()
ENDIF()

ADD_LIBRARY(openvideo SHARED ${OPENVIDEO_SOURCES} ${OPENVIDEO_HEADERS})
TARGET_LINK_LIBRARIES(openvideo ${ACE_LIBRARIES} ${TINY_XML_MOD_LIBRARIES})
IF(GLUT_FOUND)
   IF(OT_USE_GLUT)
      TARGET_LINK_LIBRARIES(openvideo ${GLUT_LIBRARIES})
   ENDIF()
ENDIF()
IF(OpenCV_FOUND)
   IF(OT_USE_OPENCV)
      TARGET_LINK_LIBRARIES(openvideo ${OPENCV_LIBRARIES})
   ENDIF()
ENDIF()
   
INSTALL(TARGETS openvideo DESTINATION ${CMAKE_INSTALL_LIBDIR})
SET_TARGET_PROPERTIES(openvideo PROPERTIES VERSION ${CPACK_PACKAGE_VERSION} SOVERSION ${CPACK_PACKAGE_VERSION_MAJOR})
